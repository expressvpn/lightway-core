--- # ceedling project file for Linux
:import:
  - unix.yml

:release_build:
  :output: lightway-fuzz

:paths:
  :test:
    - +:test/**
    - -:test/support
  :include:
    - include/**
  :source:
    - src/**
    - fuzz/**
  :support:
    - test/support

:dependencies:
  :libraries:
    - :name: WolfSSL
      :source_path: third_party/wolfssl
      :artifact_path: third_party/builds/wolfssl_build
      :fetch:
        :method: :git
        :source: $HE_WOLFSSL_SOURCE
        :hash: $HE_WOLFSSL_COMMIT
      :environment:
        - CFLAGS=-O3 -fPIC -D_FORTIFY_SOURCE=2 -DWOLFSSL_DTLS_ALLOW_FUTURE -DWOLFSSL_MIN_RSA_BITS=2048 -DWOLFSSL_MIN_ECC_BITS=256 -DUSE_CERT_BUFFERS_4096 -DUSE_CERT_BUFFERS_256
      :build:
        - git apply ../../wolfssl/0001-Merge-pull-request-5911-from-julek-wolfssl-DtlsMsgPo.patch
        - git apply ../../wolfssl/0001-Merge-pull-request-5932-from-julek-wolfssl-zd15346.patch
        - "autoreconf -i"
        - "./configure --enable-tls13 --disable-oldtls --enable-aesni --prefix=$(pwd)/../builds/wolfssl_build --enable-static --enable-singlethreaded --enable-dtls --enable-sp=yes,4096 --enable-sp-asm --disable-shared --enable-dtls-mtu --disable-sha3 --enable-intelasm --disable-dh --enable-curve25519 --enable-secure-renegotiation --disable-examples --disable-sys-ca-certs --enable-sni"
        - "make"
        - "make install"
        - nm -a ../builds/wolfssl_build/lib/libwolfssl.a | grep InitSuitesHashSigAlgo_ex
      :artifacts:
        :includes:
          - include
          - include/wolfssl # needed e.g. for mock_ssl.h to find wolfssl/ssl.h
        :static_libraries:
          - lib/libwolfssl.a

:flags:
  :release:
    :compile:
      :*:
        - -g
        - -fPIC
        - -fsanitize=fuzzer,address
    :link:
      :*:
        - -fsanitize=fuzzer,address
