--- # ceedling project file for 3rd party dependencies

# Build instructions for liboqs taken from:
# https://github.com/wolfSSL/wolfssl/blob/106a065a41f283d7603cda824d857d308287da3b/INSTALL#L139
# https://www.wolfssl.com/documentation/manuals/wolfssl/appendix07.html

:dependencies:
  :libraries:
    - :name: liboqs
      :source_path: third_party/liboqs
      :fetch:
        :method: :git
        :source: https://github.com/open-quantum-safe/liboqs
        :tag: 0.8.0
      :environment:
        # CFLAGS taken from: https://www.wolfssl.com/documentation/manuals/wolfssl/appendix07.html
        - CFLAGS= -Os
      :build:
        # Build the library only, do not use OpenSSL, Set algorithms to support WolfSSL's "WOLFSSL_P521_KYBER_LEVEL5", disable all other unnecessary algorithms.
        - "mkdir -p build"
        - "cd build && cmake -DCMAKE_INSTALL_PREFIX=/usr -DOQS_BUILD_ONLY_LIB=ON -DOQS_USE_OPENSSL=OFF -DOQS_MINIMAL_BUILD='KEM_kyber_512;KEM_kyber_768;KEM_kyber_1024;SIG_dilithium_2;SIG_dilithium_3;SIG_dilithium_5;SIG_falcon_512;SIG_falcon_1024' .."
        - "cd build && make all"
        - "cd build && make install"
      :artifacts:
        :includes:
          - include
          - include/oqs
        :static_libraries:
          - lib/liboqs.a

